
## 

### Vấn đề khi sửa đổi biến toàn cục

Quay lại ví dụ ban đầu về biến `enemies`:

```python
enemies = 1

def increase_enemies():
    enemies = 2
    print(f"enemies inside function: {enemies}")

increase_enemies()
print(f"enemies outside function: {enemies}")
```

**Kết quả:**

```
enemies inside function: 2
enemies outside function: 1
```

**Vấn đề:** Thay vì sửa đổi biến toàn cục `enemies`, Python đã tạo một biến cục bộ hoàn toàn mới với cùng tên. Đây là hai biến khác nhau, tồn tại ở hai scope khác nhau.

### Minh họa rõ hơn

```python
enemies = "Skeleton"

def increase_enemies():
    enemies = "Zombie"
    print(f"enemies inside function: {enemies}")

increase_enemies()
print(f"enemies outside function: {enemies}")
```

**Kết quả:**

```
enemies inside function: Zombie
enemies outside function: Skeleton
```

**Lưu ý quan trọng:** Đặt tên biến cục bộ trùng với biến toàn cục là một thói quen xấu và dễ gây nhầm lẫn. Nên tránh làm điều này trong code thực tế.

### Lỗi khi cố gắng sửa đổi

```python
enemies = 1

def increase_enemies():
    enemies += 1  # LỖI!
    print(enemies)

increase_enemies()
```

**Lỗi:** `UnboundLocalError: local variable 'enemies' referenced before assignment`

**Giải thích:** Python nghĩ bạn đang cố gắng sử dụng biến cục bộ `enemies` trước khi định nghĩa nó. Toán tử `+=` yêu cầu đọc giá trị hiện tại trước khi cộng thêm, nhưng biến cục bộ chưa được tạo.

### Từ khóa global

Để thực sự sửa đổi biến toàn cục từ trong hàm, phải sử dụng từ khóa **`global`**:

```python
enemies = 1

def increase_enemies():
    global enemies
    enemies += 1
    print(f"enemies inside function: {enemies}")

increase_enemies()
print(f"enemies outside function: {enemies}")
```

**Kết quả:**

```
enemies inside function: 2
enemies outside function: 2
```

**Cách hoạt động:** Từ khóa `global` cho Python biết rằng bạn muốn sử dụng biến toàn cục `enemies` (đã được định nghĩa bên ngoài), chứ không phải tạo biến cục bộ mới.

### Tại sao nên tránh sửa đổi Global Scope?

**Lý do:**

- **Khó theo dõi:** Biến toàn cục có thể được sửa đổi ở nhiều nơi trong code
- **Dễ gây lỗi:** Khó xác định khi nào và ở đâu biến bị thay đổi
- **Khó bảo trì:** Code viết cách nhau nhiều ngày/tuần có thể xung đột
- **Khó debug:** Khó truy vết nguồn gốc thay đổi giá trị
- **Vi phạm nguyên tắc lập trình:** Hàm nên độc lập và không phụ thuộc vào trạng thái toàn cục


### Giải pháp tốt hơn: Sử dụng return

Thay vì sửa đổi biến toàn cục, hãy trả về giá trị mới:

```python
enemies = 1

def increase_enemies():
    return enemies + 1

enemies = increase_enemies()
print(f"enemies: {enemies}")  # 2
```

**Ưu điểm:**

- Hàm độc lập, có thể sử dụng lại ở bất kỳ đâu
- Không cần biết cách hoạt động bên trong
- Dễ test và debug
- Code rõ ràng và dễ hiểu hơn


### Cải tiến thêm: Hàm linh hoạt

```python
enemies = 1

def increase_enemies(current_enemies):
    return current_enemies + 1

enemies = increase_enemies(enemies)
print(f"enemies: {enemies}")  # 2
```

**Ưu điểm của cách này:**

- Hàm hoàn toàn độc lập, không phụ thuộc biến toàn cục
- Có thể tái sử dụng với bất kỳ giá trị nào
- Dễ test: chỉ cần truyền input và kiểm tra output
- Tuân thủ nguyên tắc **Pure Function** (hàm thuần túy)


### So sánh các cách tiếp cận

```python
# ❌ Cách XẤU: Sửa đổi global scope
enemies = 1

def increase_enemies():
    global enemies
    enemies += 1

increase_enemies()


# ✅ Cách TỐT: Sử dụng return
enemies = 1

def increase_enemies():
    return enemies + 1

enemies = increase_enemies()


# ✅ Cách TỐT NHẤT: Hàm thuần túy
enemies = 1

def increase_enemies(current_enemies):
    return current_enemies + 1

enemies = increase_enemies(enemies)
```


### Khi nào có thể dùng global?

**Trường hợp hiếm hoi có thể chấp nhận:**

- Constants (hằng số) được định nghĩa ở đầu file
- Configuration settings (cài đặt cấu hình)
- Khi thực sự cần chia sẻ trạng thái giữa nhiều hàm

**Tuy nhiên:** Ngay cả trong các trường hợp này, sử dụng class hoặc dictionary thường là lựa chọn tốt hơn.

### Quy tắc vàng

**Đọc biến toàn cục:** ✅ Được phép và an toàn

```python
player_name = "Hero"

def greet_player():
    print(f"Hello, {player_name}!")  # OK
```

**Sửa đổi biến toàn cục:** ❌ Nên tránh

```python
score = 0

def increase_score():
    global score
    score += 10  # Tránh làm điều này
```

**Thay thế bằng return:** ✅ Cách tốt nhất

```python
score = 0

def increase_score(current_score):
    return current_score + 10  # Làm như này

score = increase_score(score)
```

**Liên kết:** [[Global Scope]], [[Local Scope]], [[global keyword]], [[Return Statement]], [[Pure Functions]], [[Function Best Practices]], [[Code Maintainability]]

***

Bạn có muốn tôi giải thích thêm về khái niệm Pure Functions hoặc các design patterns để quản lý state tốt hơn không?

