

## Tái tạo lỗi (Reproducing Bugs)

### Khái niệm quan trọng

Bước thứ hai trong [[debugging]] là **tái tạo lỗi** (reproducing the bug). Đây là kỹ thuật quan trọng vì:

- Lỗi chỉ xuất hiện ngẫu nhiên rất khó sửa
- Nếu không thể tái tạo lỗi một cách nhất quán, việc debug trở nên gần như bất khả thi
- Cần xác định **khi nào** lỗi xảy ra để có thể khắc phục


### Ví dụ: Lỗi ngẫu nhiên với xúc xắc

**Đoạn code ban đầu:**

```python
import random

dice_images = ["⚀", "⚁", "⚂", "⚃", "⚄", "⚅"]
dice_num = random.randint(1, 6)
print(dice_images[dice_num])
```

**Vấn đề:**

- Code đôi khi chạy bình thường
- Nhưng đôi khi xuất hiện lỗi `IndexError: list index out of range`
- Loại lỗi này rất khó phát hiện nếu chỉ test 1-2 lần


### Quy trình tái tạo lỗi

**Bước 1: Xác định điều kiện gây lỗi**

- Phân tích code: `dice_num` là số ngẫu nhiên từ 1 đến 6
- Kiểm tra tài liệu [[randint()]]: trả về số ngẫu nhiên trong khoảng A đến B, **bao gồm cả hai đầu**
- Nghĩa là `randint(1, 6)` có thể tạo ra: 1, 2, 3, 4, 5, hoặc 6

**Bước 2: Test từng giá trị**

- `dice_num = 1` → Chạy bình thường
- `dice_num = 2, 3, 4, 5` → Chạy bình thường
- `dice_num = 6` → **Luôn gây lỗi!**

**Bước 3: Phân tích nguyên nhân**

```python
# List index trong Python bắt đầu từ 0
dice_images[0]  # ⚀ (Dice 1)
dice_images[1]  # ⚁ (Dice 2)
dice_images[2]  # ⚂ (Dice 3)
dice_images[3]  # ⚃ (Dice 4)
dice_images[4]  # ⚄ (Dice 5)
dice_images[5]  # ⚅ (Dice 6)
dice_images[6]  # ❌ IndexError - không tồn tại!
```


### Giải pháp

**Code đã sửa:**

```python
import random

dice_images = ["⚀", "⚁", "⚂", "⚃", "⚄", "⚅"]
dice_num = random.randint(0, 5)  # Thay đổi từ (1, 6) thành (0, 5)
print(dice_images[dice_num])
```

**Giải thích:**

- [[List indexing]] trong Python bắt đầu từ 0, không phải 1
- List có 6 phần tử → index hợp lệ từ 0 đến 5
- Đổi `randint(1, 6)` thành `randint(0, 5)` để khớp với index của list


### Bài học rút ra

**Khi gặp lỗi ngẫu nhiên:**

- Cố gắng tái tạo lỗi một cách nhất quán
- Xác định điều kiện cụ thể gây ra lỗi
- Test với các giá trị biên (boundary values)
- Hiểu rõ cách hoạt động của các hàm đang sử dụng

**Lưu ý quan trọng:**

- `range(1, 6)` → tạo ra: 1, 2, 3, 4, 5 (không bao gồm 6)
- `randint(1, 6)` → tạo ra: 1, 2, 3, 4, 5, 6 (bao gồm cả 6)
- [[List index]] luôn bắt đầu từ 0 trong Python

***

**Liên kết:** [[Debugging]], [[reproducing bugs]], [[IndexError]], [[randint()]], [[list indexing]], [[random module]], [[boundary testing]]

